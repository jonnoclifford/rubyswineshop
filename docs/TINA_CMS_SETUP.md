# Tina CMS Setup Documentation

## Overview

This Next.js 15 App Router project is integrated with **Tina CMS** for visual content management. The setup supports both local filesystem-based editing and cloud-based editing via Tina Cloud.

## Architecture

### Key Components

1. **Admin Interface** (`/public/admin/index.html`)
   - Generated by Tina CMS build process
   - Serves the visual editor UI
   - Accessible at `/admin` route

2. **App Router Configuration** (`/src/app/admin/page.tsx`)
   - Redirects `/admin` to `/admin/index.html`
   - Ensures clean URL access to admin interface

3. **API Route** (`/src/app/api/tina/[...routes]/route.ts`)
   - Handles all Tina backend operations
   - Supports both local filesystem and Tina Cloud
   - Uses `TinaNodeBackend` for request handling

4. **Database Client** (`/src/lib/tina.ts`)
   - Configures local or cloud database
   - Switches based on `TINA_PUBLIC_IS_LOCAL` environment variable

5. **Tina Configuration** (`/.tina/config.ts`)
   - Defines content schema
   - Configures collections and fields
   - Sets build output location

## Setup Instructions

### 1. Environment Configuration

The `.env.local` file contains:

```env
# Tina CMS Configuration
TINA_PUBLIC_IS_LOCAL=true              # Use local filesystem mode
NEXT_PUBLIC_TINA_CLIENT_ID=dummy       # Placeholder for local mode
TINA_TOKEN=dummy                       # Placeholder for local mode
NEXT_PUBLIC_TINA_BRANCH=main           # Branch name for content
```

### 2. Running in Development

Start the development server with Tina:

```bash
npm run dev
```

This command:
- Runs `tinacms dev -c "next dev"`
- Starts Tina CMS server on port 4001
- Starts Next.js dev server on port 3000
- Starts Tina datalayer server on port 9000

### 3. Accessing the Admin Interface

Once the dev server is running:

1. Navigate to **http://localhost:3000/admin**
2. The page will redirect to `/admin/index.html`
3. Tina will load the visual editor interface
4. You can now edit content visually

## Content Management

### Content Structure

Content is stored in `/src/content/site-config.json` with the following sections:

- **Business Information**: Name, address, contact, hours, coordinates
- **Hero Section**: Headlines, CTAs, images
- **About Section**: Story paragraphs, images
- **Menu Section**: Wines by glass, by bottle, snacks
- **Hungry Section**: Partner information
- **What's On**: Events and activities
- **FAQ**: Frequently asked questions
- **Walk-In Modal**: Booking policy messaging
- **Find Us**: Map embed and contact info
- **SEO**: Meta tags, keywords, Open Graph image

### Editing Content

**Via Tina Admin:**
1. Go to http://localhost:3000/admin
2. Browse collections in the sidebar
3. Click "Site Configuration"
4. Edit fields using the visual editor
5. Save changes

**Via Direct File Editing:**
1. Open `/src/content/site-config.json`
2. Edit the JSON directly
3. Save the file
4. Changes reflect immediately in development

## Tina Cloud Integration (Optional)

For production deployments with cloud-based editing:

### 1. Sign Up for Tina Cloud

1. Visit [tina.io](https://app.tina.io)
2. Create an account
3. Create a new project

### 2. Get Credentials

From your Tina Cloud project dashboard:
- Copy your **Client ID**
- Generate a **Read-Only Token**

### 3. Update Environment Variables

In `.env.local` (development) and your hosting platform (production):

```env
TINA_PUBLIC_IS_LOCAL=false                    # Disable local mode
NEXT_PUBLIC_TINA_CLIENT_ID=your_client_id     # Your actual client ID
TINA_TOKEN=your_token                         # Your actual token
NEXT_PUBLIC_TINA_BRANCH=main                  # Your git branch
```

### 4. Build and Deploy

```bash
npm run build
```

This will:
- Build the Tina admin interface
- Generate the Next.js production build
- Create optimized assets

## File Structure

```
├── .tina/
│   ├── config.ts                      # Tina configuration
│   └── __generated__/                 # Auto-generated types and schemas
│       ├── client.ts
│       ├── types.ts
│       └── ...
├── public/
│   └── admin/
│       ├── index.html                 # Admin interface (generated)
│       └── .gitignore                 # Ignores generated assets
├── src/
│   ├── app/
│   │   ├── admin/
│   │   │   └── page.tsx               # Admin route (redirects)
│   │   └── api/
│   │       └── tina/
│   │           └── [...routes]/
│   │               └── route.ts       # Tina API handler
│   ├── content/
│   │   ├── site-config.json           # Content data
│   │   └── site-config.ts             # Legacy TS config (deprecated)
│   └── lib/
│       └── tina.ts                    # Database client configuration
└── docs/
    └── TINA_CMS_SETUP.md              # This file
```

## Troubleshooting

### Admin Interface Not Loading

**Problem**: /admin shows blank page or errors

**Solutions**:
1. Ensure dev server is running: `npm run dev`
2. Check that port 4001 is not blocked
3. Clear browser cache
4. Check console for errors

### Port Already in Use

**Problem**: Error: "Datalayer server is busy on port 9000"

**Solutions**:
```bash
# Kill processes on Tina ports
lsof -ti:4001 | xargs kill -9
lsof -ti:9000 | xargs kill -9

# Restart dev server
npm run dev
```

### Content Not Saving

**Problem**: Changes in admin don't persist

**Solutions**:
1. Check file permissions on `src/content/`
2. Verify `TINA_PUBLIC_IS_LOCAL=true` in `.env.local`
3. Check console for GraphQL errors
4. Ensure `site-config.json` exists and is writable

### Build Errors

**Problem**: "Client not configured properly" during build

**Solutions**:
1. For local builds, the error is expected (admin is for dev only)
2. For cloud builds, verify `NEXT_PUBLIC_TINA_CLIENT_ID` and `TINA_TOKEN`
3. Use `npm run build` instead of `tinacms build`

## API Routes

### Tina Backend Routes

All routes under `/api/tina/*` are handled by the Tina backend:

- `/api/tina/graphql` - GraphQL queries for content
- `/api/tina/upload` - Media upload endpoint
- `/api/tina/*` - Other Tina operations

These routes automatically support:
- Local filesystem operations (when `TINA_PUBLIC_IS_LOCAL=true`)
- Tina Cloud operations (when cloud credentials are configured)
- Authentication (local bypass or cloud auth)

## Best Practices

### Development Workflow

1. **Always use `npm run dev`** for development (not `npm run dev:next`)
2. **Edit content via admin** for visual feedback
3. **Commit `site-config.json`** to version control
4. **Never commit** `/public/admin/index.html` or `/public/admin/assets/`

### Content Editing

1. **Use admin interface** for complex edits (nested objects, lists)
2. **Use JSON directly** for quick text updates
3. **Test changes locally** before deploying
4. **Backup content** before major restructuring

### Deployment

1. **Set environment variables** in your hosting platform
2. **Run `npm run build`** to build both Next.js and Tina
3. **Verify admin access** after deployment (if using cloud)
4. **Use cloud mode** for production editing capabilities

## Additional Resources

- [Tina CMS Documentation](https://tina.io/docs/)
- [Tina Cloud Setup Guide](https://tina.io/docs/tina-cloud/)
- [Next.js App Router with Tina](https://tina.io/docs/frameworks/next/)
- [Tina GraphQL API](https://tina.io/docs/graphql/)

## Support

For Tina-specific issues:
- [Tina Discord Community](https://discord.com/invite/zumN63Ybpf)
- [Tina GitHub Issues](https://github.com/tinacms/tinacms/issues)

For project-specific issues:
- Contact the development team
- Check project documentation in `/docs/`
